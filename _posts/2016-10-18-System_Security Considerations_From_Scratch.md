---
layout: post
title: 从零开始的平台总体安全体系的考量
key: 20161018
tags: 架构 互联网 基础系统 安全
---
现在互联网的新生平台比以往面临着更复杂的技术环境。平台一上线，即面临着全方位、体系性的安全风险考验。以如下几方面情况的引入，可能衍生的安全风险尤为突出：    
  
* 面向多种类型端的用户APP产品入口的推出  
* 更加复杂的用户权益账户、储值类电子账户的引入， 如 **积分、内置钱包等**      
* 平台自有的多个支付渠道和多类型收付交易行为的引入， 如 **三方支付、交易中途改变支付方式等**  
* 更加复杂的结算和清算场景 ， 如 **用户奖励提现，外部积分互换等**  
* 更加复杂的业务和个性化的促销策略， 如 **折扣策略、优惠券和羊毛党等** 
* 以及，快速的业务场景和功能的演进。

<!--more-->   

对于很多新生的互联网业务平台来说，受制于诸多约束，多数时候是暴露在各类安全风险下前进的。本文并非要阐述如何建设一个高标准的、高等级的信息安全体系，而是，站在从零开始的场景下，梳理一个相对体系化的考量框架。毕竟，最大的风险是来自对风险的无知。如何在有限资源投入的情况下，作出各种权衡，使安全体系建设和平台发展演进相适应，才是我们真正要关注的。
  

## 一 系统的总体安全目标

安全板块划分      | 总体目标      | 备注说明
------------- | ------------- | ------------- 
运营 |安全应急响应与风控体系 | 运营全流程及体系角度来统筹推进建设
基本防护|基本的安全攻防体系|提高系统被攻击的门槛
运维 | 安全管理与审计  | 合适权限的人和系统，访问合适权限的数据和服务
监控与告警 | 实时安全监控与安全扫描  | 如何及时发现问题；合理的确定告警项和等级
研发 |安全软件的开发框架 | 使功能团队相对专注功能开发，引入安全风险的几率降低。






## 二 安全体系构建的基本思路

* 体系化建设推进，**避免**出现安全板块的 **明显短板**       
* 与产品与运营发展的相匹配，注重 **投入产出比**          
* 关键在于 **风险可控**，不断提升自我保护能力  
* 不断提升攻击成本，控制、降低被攻击的损失    
* **平衡**用户产品使用的便利性和安全性 
* 不要混淆用户的 **安全感诉求** 和真正的 **系统安全需求**   
* 借鉴和研发并举， **避免闭门造车**   



## 三 安全角度的非功能性需求建设

### 3.1 可测试性    
*优先级1*   

- 测试是验证体系安全和质量的最后一道屏障，  
- 必须首先建立对体系安全评估的测试能力。  

>#### 先想好怎么测试和验证，再思考开发实现  
-------   

因为在一开始几乎不可能有充足资源搭建强有力的测试团队。技术团队，尤其要建立这样的团队意识和基本的技术支撑。否则，随着业务功能的演进，技术团队必然陷入忙于救火，甚至乱上加乱的态势。  

  


### 3.2 可追溯性  
*优先级1*  

- 安全的基石是所有系统和用户行为的可追溯。    
    + 没有相适应的追溯体系，监控、告警、分析、改进都会无从谈起。    
    +  运营层面的个案分析、责任划分甚至赔付等都难以开展。  
- 系统内数据和日志的完整性和不可抵赖性，是追溯合法性关键。


>#### 日志记录的搜集、检索能力，是可追溯的技术基础  
------
  
暂时没有完整的日志运用平台不要紧；没有现成日志记录规范也不要紧；检索起来有点笨拙也不太要紧；
但是技术团队在代码评审时候，必须意识到，某些代码段，必须要在运行时候，记录下点什么，并且确保能记录下来。



### 3.3 安全性   
*优先级1*  

- 用户数据安全性  
    + 涵盖：用户隐私数据、用户交易数据、用户认证数据  
    + 要求：展示层、存储层、内部交互层面、外部通信层面  

- 系统交易安全性  
    + 人为操作导致的交易损失［主观故意｜过失］  
    + 系统BUG导致的交易损失［设计缺陷｜实现缺陷］  
 

>#### 建立多层次的防控体系， 对业务流程建立主题式风险表
------   
  
用户数据的泄漏，已然是这几年见怪不怪的新闻了。泄漏事件一旦进入公众视野，对于平台业务的成长打击是显而易见的。很多时候，泄漏都不是源于技术高超的攻击，而不过是内部管理缺陷和安全意识的淡薄的结果。   
对成长中的团队，如果技术手段跟不上，那么先考虑实现基本的安全原则，以及更加严格的数据权限纪律1，2，3...。作为团队领导，必须有足够的安全敏感度，清晰的意识到哪些事情是必须首先做的。  




### 3.4 可监控 可报警  
*优先级1*  

- 可监控   
    + 对所有交易，尤其是“钱”相关的操作，能及时发现问题。  
   *监控什么？ 怎么监控？ 投入多少资源？*需要团队共同梳理清楚，排进工作中。
  
- 可报警  
    + 报警的目的是避免风险扩大、蔓延.  
    + 确定处理策略的依据      
   *确定告警项 确定告警的依据模型  确定警告散发的方式*    
 

>#### 确定优先级表格，技术研发和运营、运维要结合联动  
------  
  
信息安全体系的构建是全平台包括技术研发、运维、业务运营及客户服务等各个团队的职责。对于快速成长的平台，尤其需要高效联动，才能保证问题早发现，响应处理更高效。从而，满足用户的安全感诉求、保证用户体验，维护用户对平台的信任感。




### 3.5 内部操作安全性   
*优先级1*    

- 上线操作风险 
- 生产环境变更风险／配置管理风险
- 跨流程（跨产品线）交易修改操作风险
- 代码审核风险［如测试代码和参数被发布上线］  
- 测试风险［如测试数据］

>#### 建立明确、合理、严格的操作和评审规范 
------ 
  
制度和规范的建立需要一个过程。从别的团队照搬过来的一整套貌似完整的制度规范，在创业团队中，多数会成为摆设。若干条切中要害的研发纪律产生的效果可以是立竿见影的。从简单的几条研发纪律开始，逐步演进，完善，最终可以形成操作性强，适应实际的规范和制度。  




### 3.6 系统基本自我保护能力 
 *优先级1*  

- 容错能力 
    + 发生预期失败时，系统自己解决问题，防止应用失败。   
     ```比如自动路由功能，保证一个通道失败时，寻找新通道等。 ```    

- 快速失败原则  
    + 防止系统进入不完整运行态（比如半吊子流程）
    + 防止因为某个失败、系统进入无休止的等待（比如利用超时设置）  

- 服务降级
    + 当服务的访问量超出预期吞吐能力时，通过降级来保证服务质量，而不是让服务不降级但全部不可   
    ```降级策略不是个单纯技术问题，典型问题如：ERP库存无法读取时，是否在线商城就不让购买了？？ ```  

    + 自动降级还是手动降级，也是一个问题。  
 
- 资源限制与管控 
    + 系统资源不做管控，一定会在某个时间点发生事故。   
     ``` 管控资源的基本准则是不让局部出现资源短板，而导致体系崩溃。``` 

[关于降级的一篇参考的文档](http://www.zhongkerd.com/news/content-545.html) 
  
>#### 技术团队完全有责任不让用户陷入“系统又挂了”的惯性信任危机思维中
------

极端情况下，当内部业务和运营团队都有这样的思维惯性时，技术团队的工作开展将变得困难。重建信任的过程是异常困难的。  
举个例子，如果在系统响应能力不够时，较之卡死不动，而是直接跳转到友情提示页面，带给用户的感觉是完全不同的。让用户清晰知道，当前平台的服务能力是有限的，这不丢人，用户多数时候也会理解；但是绝不能让用户感觉到，技术团队对平台的状态是茫然和失控的。



### 3.7 避免雪崩效应   
*优先级2*  

- 所有涉及到第三方的接入都要加入防雪崩效应的策略 
 + 不能假设第三方服务不会延迟、宕机。 
 + 不能因为某个第三方服务的失败而拖垮平台本身。
 + 不能因为某个用户的某些操作行为，而拖垮其它用户的正常交易。  
 + 对于不同类型、业务频率、实时性要求的业务，要放在不同消息通道里处理。
- 防止外挂系统来影响正常业务  
 + 如系统日志、监控等，目的是为了支撑业务系统，要防止反过来影响业务系统。

>#### 建立对雪崩场景的压力测试用例，并进行测试
--------     

通过monk、压测，是在团队早期，功能上线频繁，需求不稳定，测试工作不完善的情况下，性价很高的早发现问题的方法。很大部分设计、代码的缺陷，在一定的压力下会比较容易暴露出来。 


 


### 3.8 应对活动和促销   
*优先级2*   

- 活动和促销带来的突发流量和并发的应对 
    + 结合压力测试和资源估算模型，建立对平台能力的基本判断 
    + 形成基本的活动和促销的方案预案［技术｜运营｜...］  
- 部分商家的活动和促销对其他商家的资源挤占的应对  
    + 架构上，要具备基本的资源隔离能力（除非接入带宽被完全挤占） 
    + 降级和资源管控策略相集合。  
 
>#### 需要从公司层面进行统筹        
--------       

活动和促销，已经成为很多平台暴力演进的常态化工具。并非一般意义上的安全体系问题，但是往往会引发一些潜在安全漏洞的暴露。比如促销、优惠券使用存在的潜在漏洞；或者诱人的活动，引来一些潜在的系统攻击者；当然，也不排除一些恶意的刷爆平台第三方服务的预存款行为等。这些都需要技术团队事先有所预见。
 
  
### 3.9 可配置   
*优先级2*  

-  业务层面系统参数的变化，尽量避免停机或者重启  
    ``` 如：关键服务的下架；部分系统进入维护，部分系统临时隔离等等 ``` 
-  非功能性需求的实现，需要存在人工干预人口的场景  
    ``` 如：资源管控，降级策略的调整等等 ```  
 
>#### 自动化当然好，但是很难一步到位；图形化当然好，但不是不可或缺 
------   

这个问题的本质，还是技术团队（包括运维），对平台的真正的控制力。这里控制力，不是说你有每个服务器的密码和服务重启的权限。而是你对你所有服务和每个服务在用、可用资源都能比较清晰的掌握，并在此基础上，可以实现高效的管控，调配。



### 3.10 避免单点故障   
*优先级2*   

- 单点的故障，往往不是预期会出现故障的故障点。   
   ```往往也不是软件本身导致的故障 ```  
 
- 对于短时间无法消除的单点风险，要准备失败－恢复的可靠预案。
 
>#### 预案都需要真正演练过，以证明可行、可靠 
------   

很多平台在发展初期，或多或少存在一些单点的风险。对这些高风险单点，需要单独加入一个风险关注清单，进行重点关注。并且制定一个逐步消除这类风险的中期时间表。

  

## 四 安全体系建设的日常工作策略
  
- 系统思考风险及优先级、建立风险应对和控制策略
- 不断从风险清单中整理出阶段任务清单，纳入工作计划
- 从团队建设层面的工作推动


### 4.1 部分典型风险和风控工作建议  
- 用户风险   

风险类型     | 典型风险  | 风控内容及建议 
|:-------------|:-------------|:-------------|
关键信息泄漏 | 基本防护薄弱 |从基本防护角度进行排查，保证通讯链路，APP端无明显泄漏    
交易风险 | 账户被盗 | 建立找回机制和强行密码重置。      
交易风险 | 伪冒或交易抵赖 | 可追溯机制＋（运营）核查分析机制＋（运营）自证和赔付。    

- 卖家风险  
    
风险类型     | 典型风险  | 风控内容及建议 
|:-------------|:-------------|:-------------|
交易风险 | 交易抵赖 | 可追溯机制＋（运营）核查分析机制＋（运营）自证和赔付。  
操作风险 | 误操作 | 对关键后台管理操作除了可追溯机制，对关键操作内容要加入（版本和备份策略）。  

- 法律合规风险  
    
风险类型     | 典型风险  | 风控内容及建议 
|:-------------|:-------------|:-------------|
商家交易风险 | 商品违规，套现／洗钱风险 |（从法律和运营角度需要有所预防）。    

- 平台内部风险  

风险类型     | 典型风险  | 风控内容及建议 
|:-------------|:-------------|:-------------|
人为信息泄漏 | 制度漏洞及权限管理松懈 | 保密制度＋生产数据库操作权限管理 +涉密内容的加密策略。 
网站安全漏洞|攻击/恶意篡改  | 建立基本攻防体系，细化日常工作运维审计。  

  

###  4.2 安全相关的阶段性工作任务分解 【举例】


#### § 提升可测试性   
－ 调研影响测试效率和测试效果的关键薄弱点。   
－ 着重在测试生产力工具上进行储备和改善。  
  
**参考方案／文献**  
[阿里云测](https://mqc.aliyun.com/security.htm)  
[Android APP mock测试索引](http://www.jianshu.com/p/70ac552a797e)  
[APP云测试平台比较](http://www.infoq.com/cn/articles/comparison-and-analysis-of-mobile-app-cloud-test-platform) 


#### § 提高事件追溯能力    Traceability
－ 搭建统一的日志利用平台  
－ 梳理需要追溯的流程事务、并明确粒度度和准确度准则    
－ 设定合适生产环境的日志的规范  
  
**参考方案／文献**   
[日志规范实践](http://www.jianshu.com/p/01b7cacfe202)  
[Optimal Logging](https://testing.googleblog.com/2013/06/optimal-logging.html) 


#### § 改善安全性
- 根据成熟的安全体系框架，确定每层的现阶段重点工作   
- 系统安全层面：密码安全｜服务器漏洞｜内部信息安全防控｜常见攻击的防护能力｜审计制度     
- 身份认证/证书： 认证｜证书安全｜认证过程安全
- 风险行为防控：恶意订单｜恶意注册 ｜验证码安全 
- 风险策略制定：权限等级｜风险预案｜安全等级｜审计制度 
    
**参考方案／文献**  
[“互联网+”环境下信息安全的挑战与机遇](http://www.fmi.com.cn/index.php?m=content&c=index&a=show&catid=9&id=590845)   
[基于WPKI的移动电子商务安全研究](http://www.cas.stc.sh.cn/jsjyup/pdf/2013/9/%BB%F9%D3%DAWPKI%B5%C4%D2%C6%B6%AF%B5%E7%D7%D3%C9%CC%CE%F1%B0%B2%C8%AB%D1%D0%BE%BF.pdf)  
[大型网站的 HTTPS 实践](http://op.baidu.com/2015/04/https-s01a01/)   



#### § 提升监控／告警的能力
-  整理监控点，整理告警策略表  
-  确定监控和补强策略（自建｜采购）。  
-  验证监控和告警的有效性


 
**参考方案／文献**    
[Application performance management](https://en.wikipedia.org/wiki/Application_performance_management)   

------  


#### § 团队建设方面

-  在团队内进行培训和宣讲，建立全员的安全意识  
-  推动跨部门、团队的协调和联动机制的建立。
-  逐步建立制度，优先降低高风险的操作行为｛代码｜发布｜线上操作｜...｝等  
-  在需求完善的工作中，加入非功能性需求的补全。



 *<end>*  